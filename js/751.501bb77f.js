"use strict";(self["webpackChunkcr"]=self["webpackChunkcr"]||[]).push([[751],{9465:function(s,t,e){e.r(t),e.d(t,{default:function(){return W}});var o=e(3396);function i(s,t,e,i,l,r){const n=(0,o.up)("building-selector"),a=(0,o.up)("floor-selector"),d=(0,o.up)("classroom-info"),c=(0,o.up)("apply-area");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(n,{onBuilding:t[0]||(t[0]=s=>{l.building=s})}),(0,o.Wm)(a,{"in-building":l.building,onClassroomID:t[1]||(t[1]=s=>{l.classroomID=s})},null,8,["in-building"]),(0,o.Wm)(d,{classroomID:l.classroomID},null,8,["classroomID"]),(0,o.Wm)(c,{classroomID:l.classroomID},null,8,["classroomID"])],64)}var l=e(4332),r=e(6480),n=e(9950),a=e(7139),d=e(9242);const c=s=>((0,o.dD)("data-v-cb06c71a"),s=s(),(0,o.Cn)(),s),u={class:"applyArea"},h={class:"schedule ts-box borderShadow"},f={class:"ts-table is-definition is-celled"},m=c((()=>(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th"),(0,o._)("th",null,"星期一"),(0,o._)("th",null,"星期二"),(0,o._)("th",null,"星期三"),(0,o._)("th",null,"星期四"),(0,o._)("th",null,"星期五")])],-1))),b={class:"confirm box"},p={class:"confirm-emptyText"},P=c((()=>(0,o._)("span",{class:"ts-icon is-plus-icon is-huge"},null,-1))),D={class:"confirm-text"},y=c((()=>(0,o._)("span",{class:"confirm-title"},"[ 已選擇 ]",-1))),_=c((()=>(0,o._)("br",null,null,-1))),w=c((()=>(0,o._)("br",null,null,-1))),g=c((()=>(0,o._)("br",null,null,-1))),k={class:"confirm-buttons"},I={class:"periodLegend box"},T={class:"ts-box is-collapsed"},C={class:"ts-table is-collapsed is-celled"};function S(s,t,e,i,l,r){return(0,o.wg)(),(0,o.iD)("div",u,[(0,o._)("div",h,[(0,o._)("table",f,[m,(0,o._)("tbody",{ref:"scheduleTable",onClick:t[0]||(t[0]=(...s)=>r.clickScheduleTable&&r.clickScheduleTable(...s))},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.periodTime,((s,t)=>((0,o.wg)(),(0,o.iD)("tr",{key:t},[(0,o._)("td",null,[(0,o._)("div",null,"第  "+(0,a.zw)(s.nth)+"  節",1),(0,o.Uk)(" "+(0,a.zw)(s.startTime)+" ~ "+(0,a.zw)(s.endTime),1)]),((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)(5,(s=>(0,o._)("td",{key:s}))),64))])))),128))],512)])]),(0,o._)("div",null,[(0,o._)("div",b,[(0,o.wy)((0,o._)("span",p,[P,(0,o.Uk)(" 目前沒有選取任何時段，請直接點選左側的課表。 ")],512),[[d.F8,!l.confirm.enable]]),(0,o.wy)((0,o._)("span",D,[y,_,(0,o._)("span",null,[(0,o.Uk)((0,a.zw)(l.classroomInfo.building),1),w,(0,o.Uk)(" "+(0,a.zw)(l.classroomInfo.name),1),g,(0,o.Uk)(" "+(0,a.zw)(l.confirm.day)+" "+(0,a.zw)(l.confirm.time)+" ( "+(0,a.zw)(l.confirm.period)+" ) ",1)])],512),[[d.F8,l.confirm.enable]]),(0,o.wy)((0,o._)("div",k,[(0,o._)("button",{class:"borderShadow ts-button is-accent",onClick:t[1]||(t[1]=s=>r.clickApplyButton())},"送出申請"),(0,o._)("button",{class:"borderShadow ts-button is-accent is-secondary",onClick:t[2]||(t[2]=s=>r.resetsDP())},"取消並重置")],512),[[d.F8,l.confirm.enable]])]),(0,o._)("div",I,[(0,o._)("div",T,[(0,o._)("table",C,[(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.legendData,(s=>((0,o.wg)(),(0,o.iD)("tr",{key:s.color},[(0,o._)("td",{style:(0,a.j5)({width:"50px",backgroundColor:s.color})},null,4),(0,o._)("td",null,(0,a.zw)(s.name),1)])))),128))])])])])])])}var v=e(6228),x=e(1842),B=e(5591),z={props:["classroomID"],data(){return{classroomInfo:(0,x.S)(null),periodTime:v.B,periodState:null,sDP:{day:null,startPeriod:null,endPeriod:null},confirm:{enable:!1,day:"",time:"",period:""},legendData:[{name:"選取的時段",color:"#aaf"},{name:"可借用",color:"#fff"},{name:"被別人借用",color:"#fbb"},{name:"被自己借用",color:"#bfb"},{name:"無法借用",color:"#bbb"}]}},mounted(){this.initScheduleTable()},methods:{setCellBgColor(s,t,e){const o=this.$refs.scheduleTable;try{o.rows[t-1].cells[s].style.backgroundColor=e}catch(i){}},async initScheduleTable(){const s={0:"#fff",1:"#fbb",2:"#bfb",100:"#bbb"};this.periodState=Array.from(Array(6),(()=>Array(this.periodTime.length+1).fill(100)));try{const t=await(0,B.vx)(this.classroomInfo.id),e=Object.values(t);for(const s of e)for(let t=s.startPeriod;t<=s.endPeriod;t++)this.periodState[s.day][t]=0;const o=await(0,B.dN)();for(const s of o)if(s.classroomID==this.classroomInfo.id&&(2==s.status||3==s.status))for(let t=s.period.startPeriod;t<=s.period.endPeriod;t++)this.periodState[s.period.day][t]=1;const i=await(0,B.iG)();for(const s of Object.values(i))if(s.classroomID==this.classroomInfo.id&&(2==s.status||3==s.status))for(let t=s.period.startPeriod;t<=s.period.endPeriod;t++)this.periodState[s.period.day][t]=2;const l=new Date,r=l.getDay();if(r>=1&&r<=5)for(let s=1;s<=r;s++)for(let t=1;t<=9;t++)this.periodState[s][t]=100;for(let n=1;n<=5;n++)for(let t=1;t<=this.periodTime.length;t++)this.setCellBgColor(n,t,s[this.periodState[n][t]])}catch(t){console.error("Error during schedule table initialization:",t)}},resetsDP(){if(null!=this.sDP.day){for(let s=this.sDP.startPeriod;s<=this.sDP.endPeriod;s++)this.setCellBgColor(this.sDP.day,s,"#fff0");this.sDP={day:null,startPeriod:null,endPeriod:null},this.updateConfirmBox()}},clickScheduleTable(s){const t=s.target;if("TD"!=t.tagName)return;const e=t.cellIndex,o=this.periodTime[t.parentNode.rowIndex-1].nth;e>=1&&o>=1&&0==this.periodState[e][o]&&(null==this.sDP.day?this.sDP={day:e,startPeriod:o,endPeriod:o}:e==this.sDP.day&&o>=this.sDP.startPeriod-1&&o<=this.sDP.endPeriod+1?(o==this.sDP.startPeriod-1&&(this.sDP.startPeriod-=1),o==this.sDP.endPeriod+1&&(this.sDP.endPeriod+=1)):(this.resetsDP(),this.sDP={day:e,startPeriod:o,endPeriod:o}),this.setCellBgColor(e,o,"#aaf"),this.updateConfirmBox())},updateConfirmBox(){if(this.confirm.enable=null!=this.sDP.day,!this.confirm.enable)return;const s=["","星期一","星期二","星期三","星期四","星期五"];this.confirm.day=s[this.sDP.day],this.confirm.time=`${this.periodTime[this.sDP.startPeriod-1].startTime}~${this.periodTime[this.sDP.endPeriod-1].endTime}`;const t=`${100*this.sDP.day+this.sDP.startPeriod}`,e=`${100*this.sDP.day+this.sDP.endPeriod}`;this.sDP.startPeriod==this.sDP.endPeriod?this.confirm.period=t:this.confirm.period=`${t}~${e}`},async clickApplyButton(){const s=await(0,B.Uh)(this.classroomInfo.id,this.sDP);switch(s){case 200:alert("申請成功 !\n請至借用紀錄頁面查看最新狀態，管理員將盡速審核你的請求。\n鑰匙歸還期限為借用日後一日系辦關門前。");break;case 400:alert("申請失敗 !");break;default:alert("未知錯誤");break}this.resetsDP()}},watch:{classroomID(s){this.classroomInfo=(0,x.S)(s),this.resetsDP(),this.initScheduleTable()}}},$=e(89);const A=(0,$.Z)(z,[["render",S],["__scopeId","data-v-cb06c71a"]]);var U=A,Z={components:{"building-selector":l.Z,"floor-selector":r.Z,"classroom-info":n.Z,"apply-area":U},data(){return{building:null,classroomID:null}}};const H=(0,$.Z)(Z,[["render",i]]);var W=H}}]);
//# sourceMappingURL=751.501bb77f.js.map