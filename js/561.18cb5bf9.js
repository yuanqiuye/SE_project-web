"use strict";(self["webpackChunkcr"]=self["webpackChunkcr"]||[]).push([[561],{5591:function(t,n,o){async function e(){const t=localStorage.getItem("loggedInAccount");try{const n=await fetch("https://qiuye.mooo.com/api/app/getUserPeriodData",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({userAccount:t})});if(!n.ok)throw new Error("请求失败");const o=await n.json(),e=Object.values(o),i=await Promise.all(e.map((async t=>{var n=t.period.startPeriod,o=t.period.endPeriod;const e=new Date(n),i=new Date(o),r={day:e.getDay(),startPeriod:e.getHours()-7,endPeriod:i.getHours()-8};return t.period=r,t})));return console.log("getUserPeriodData",i),i}catch(n){throw console.error(n),n}}async function i(){try{const t=await fetch("https://qiuye.mooo.com/api/app/getAllUserPeriodData",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok)throw new Error("请求失败");const n=await t.json(),o=Object.values(n),e=o.map((t=>{var n=t.period.startPeriod,o=t.period.endPeriod;const e=new Date(n),i=new Date(o),r={day:e.getDay(),startPeriod:e.getHours()-7,endPeriod:i.getHours()-8};return t.period=r,t}));return console.log(e),e}catch(t){throw console.error(t),t}}async function r(t){const n=await fetch("https://qiuye.mooo.com/api/app/getEnablePeriodData",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({classroomID:t})});if(!n.ok)throw new Error("请求失败");const o=await n.json();return o}async function s(t,n){try{const o="https://qiuye.mooo.com/api/app/setEnablePeriod",e=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({classroomID:t,enablePeriod:n})});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return e.json()}catch(o){throw console.error("Error during setEnablePeriod:",o),o}}async function a(){try{const t=await fetch("https://qiuye.mooo.com/api/app/getAllEnablePeriodData",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok)throw new Error("请求失败");const n=await t.json();return console.log(n),n}catch(t){throw console.error(t),t}}function c(t,n,o){var e=new Date;e.setHours(0,0,0,0);const i=e.getDay(),r=0===i?6:i-1,s=new Date(e);s.setDate(e.getDate()-r),e=new Date(e),6==i||7==i?e.setDate(s.getDate()+t+6):e.setDate(s.getDate()+t-1);const a=new Date(e);1===n?a.setHours(8,20,0,0):2===n?a.setHours(9,20,0,0):3===n?a.setHours(10,20,0,0):4===n?a.setHours(11,15,0,0):5===n?a.setHours(12,10,0,0):6===n?a.setHours(13,10,0,0):7===n?a.setHours(14,10,0,0):8===n?a.setHours(15,10,0,0):9===n&&a.setHours(16,5,0,0);const c=new Date(e);return 1===c?c.setHours(9,10,0,0):2===o?c.setHours(10,10,0,0):3===o?c.setHours(11,10,0,0):4===o?c.setHours(12,5,0,0):5===o?c.setHours(13,0,0,0):6===o?c.setHours(14,0,0,0):7===o?c.setHours(15,0,0,0):8===o?c.setHours(16,0,0,0):9===o&&c.setHours(16,55,0,0),{startPeriod:a.toJSON(),endPeriod:c.toJSON()}}async function l(t,n){const o=c(n.day,n.startPeriod,n.endPeriod),e="https://qiuye.mooo.com/api/app/sendApply",i=JSON.parse(localStorage.getItem("loggedInAccount"));n=o,console.log(n);try{const o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({classroomID:t,selectedPeriod:n,userAccount:i})});if(!o.ok)throw new Error("Network response was not ok");const r=await o.json();if(console.log(r.code),"200"==r.code)return 200;if("400"==r.code)return 400}catch(r){throw console.error("There has been a problem with your fetch operation:",r),r}}async function u(t){try{const n=await fetch("https://qiuye.mooo.com/api/app/cancelApply",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({pid:t})});if(!n.ok)throw new Error(`取消申请失败，状态码：${n.status}`);const o=await n.json();return console.log("取消申请成功",o),200}catch(n){return console.error("取消申请时发生错误",n.message),400}}async function d(t){try{const n=await fetch("https://qiuye.mooo.com/api/app/deletePeriodData",{method:"POST",headers:{"Content-Type":"application/json",Origin:"Origin"},credentials:"include",body:JSON.stringify({pid:t})});if(!n.ok)throw new Error(`取消申请失败，状态码：${n.status}`);const o=await n.json();return console.log("刪除申請成功",o),200}catch(n){return console.error("刪除申請时发生错误",n.message),400}}async function p(t){try{const n=await fetch("https://qiuye.mooo.com/api/app/LendKey",{method:"POST",headers:{"Content-Type":"application/json",Origin:"Origin"},credentials:"include",body:JSON.stringify({pid:t})});if(!n.ok)throw new Error(`借出鑰匙失败，状态码：${n.status}`);const o=await n.json();return console.log("借出鑰匙成功",o),200}catch(n){return console.error("借出鑰匙时发生错误",n.message),400}}async function h(t){try{const n=await fetch("https://qiuye.mooo.com/api/app/ReceiveKey",{method:"POST",headers:{"Content-Type":"application/json",Origin:"Origin"},credentials:"include",body:JSON.stringify({pid:t})});if(!n.ok)throw new Error(`歸還鑰匙失败，状态码：${n.status}`);const o=await n.json();return console.log("歸還鑰匙成功",o),200}catch(n){return console.error("歸還鑰匙发生错误",n.message),400}}async function w(t){try{const n=await fetch("https://qiuye.mooo.com/api/app/acceptRequest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pid:t}),credentials:"include"});if(!n.ok)throw new Error(`接受時段申請失败，状态码：${n.status}`);const o=await n.json();return console.log("接受時段申請成功",o),200}catch(n){return console.error("接受時段申請发生错误",n.message),400}}async function y(t){try{const n=await fetch("https://qiuye.mooo.com/api/app/rejectRequest",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({pid:t})});if(!n.ok)throw new Error(`拒絕時段申請失败，状态码：${n.status}`);const o=await n.json();return console.log("拒絕時段申請成功",o),200}catch(n){return console.error("拒絕時段申請发生错误",n.message),400}}async function f(){try{const t=await fetch("https://qiuye.mooo.com/api/app/getAllUserPoint",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({})});if(!t.ok)throw new Error("Network response was not ok");const n=await t.json();return n}catch(t){throw console.error("There has been a problem with your fetch operation:",t),t}}async function g(t){try{const n=await fetch("https://qiuye.mooo.com/api/app/getUserPoint",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({account:t})});if(!n.ok)throw new Error("Network response was not ok");const o=await n.json();return o}catch(n){throw console.error("There has been a problem with your fetch operation:",n),n}}async function m(t,n){try{const o=await fetch("https://qiuye.mooo.com/api/app/setUserPoint",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({account:t,point:n})});if(!o.ok)throw new Error(`请求失败，状态码: ${o.status}`);return 200}catch(o){throw console.error("设置用户计分数据失败",o.message||o),o}}async function P(t,n){try{const o=await fetch("https://qiuye.mooo.com/api/app/setUserBanState",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({account:t,state:n})});if(!o.ok)throw new Error("请求失败");return o.status}catch(o){throw console.error("设置用户计分数据失败",o),o}}o.d(n,{Bs:function(){return u},ED:function(){return w},QN:function(){return y},Uh:function(){return l},bK:function(){return s},c0:function(){return a},dN:function(){return i},iG:function(){return e},iU:function(){return m},jo:function(){return h},pe:function(){return p},rp:function(){return g},tU:function(){return d},tX:function(){return f},vx:function(){return r},yj:function(){return P}})},561:function(t,n,o){o.r(n),o.d(n,{default:function(){return F}});var e=o(3396);function i(t,n,o,i,r,s){const a=(0,e.up)("user-info-table");return(0,e.wg)(),(0,e.j4)(a,{"insert-data":i.insertData},null,8,["insert-data"])}var r=o(4870),s=o(9242),a=o(7139);const c=t=>((0,e.dD)("data-v-7070bba2"),t=t(),(0,e.Cn)(),t),l={class:"ts-box borderShadow"},u={class:"main-table ts-table is-celled"},d={class:"main-table-fliter-account"},p={class:"ts-input is-start-icon is-solid"},h=c((()=>(0,e._)("span",{class:"ts-icon is-magnifying-glass-icon"},null,-1))),w={class:"ts-select is-solid"},y=c((()=>(0,e._)("option",{value:"0"},"學生",-1))),f=c((()=>(0,e._)("option",{value:"1"},"教師",-1))),g=c((()=>(0,e._)("option",{value:"2"},"管理員",-1))),m=[y,f,g],P=c((()=>(0,e._)("td",null,null,-1))),b={class:"ts-select is-solid"},k=c((()=>(0,e._)("option",{value:"0"},"正常",-1))),D=c((()=>(0,e._)("option",{value:"1"},"被封鎖",-1))),S=[k,D],O=c((()=>(0,e._)("span",{class:"ts-icon is-rotate-right-icon"},null,-1))),T=[O],_=c((()=>(0,e._)("tr",null,[(0,e._)("td",null,"使用者"),(0,e._)("td",null,"身分"),(0,e._)("td",null,"違規點數"),(0,e._)("td",null,"狀態"),(0,e._)("td",null,[(0,e._)("span",{class:"ts-icon is-gears-icon"})])],-1))),j={class:"rowData-point"},C=["onClick"],H=["onClick"],v=["onClick"];function B(t,n,o,i,r,c){return(0,e.wg)(),(0,e.iD)("div",l,[(0,e._)("table",u,[(0,e._)("tbody",null,[(0,e._)("tr",null,[(0,e._)("td",d,[(0,e._)("div",p,[h,(0,e.wy)((0,e._)("input",{type:"text",placeholder:"學號","onUpdate:modelValue":n[0]||(n[0]=t=>r.fliter.account=t)},null,512),[[s.nr,r.fliter.account]])])]),(0,e._)("td",null,[(0,e._)("div",w,[(0,e.wy)((0,e._)("select",{"onUpdate:modelValue":n[1]||(n[1]=t=>r.fliter.role=t)},m,512),[[s.bM,r.fliter.role]])])]),P,(0,e._)("td",null,[(0,e._)("div",b,[(0,e.wy)((0,e._)("select",{"onUpdate:modelValue":n[2]||(n[2]=t=>r.fliter.banned=t)},S,512),[[s.bM,r.fliter.banned]])])]),(0,e._)("td",null,[(0,e._)("span",{class:"ts-icon is-caret-left-icon main-table-resetButton iconButton",title:"重置篩選器",onClick:n[3]||(n[3]=(...t)=>c.resetFliter&&c.resetFliter(...t))},T)])]),_,((0,e.wg)(!0),(0,e.iD)(e.HY,null,(0,e.Ko)(o.insertData,(t=>(0,e.wy)(((0,e.wg)(),(0,e.iD)("tr",{key:t.account},[(0,e._)("td",null,(0,a.zw)(t.account),1),(0,e._)("td",null,(0,a.zw)(r.getRoleText[t.role]),1),(0,e._)("td",null,[(0,e.wy)((0,e._)("span",{class:"ts-icon is-minus-icon iconButton",onClick:n[4]||(n[4]=(...t)=>c.minusPointButton&&c.minusPointButton(...t))},null,512),[[s.F8,r.editingPoint.account==t.account]]),(0,e._)("span",j,(0,a.zw)(r.editingPoint.account==t.account?r.editingPoint.point:t.point),1),(0,e.wy)((0,e._)("span",{class:"ts-icon is-plus-icon iconButton",onClick:n[5]||(n[5]=(...t)=>c.plusPointButton&&c.plusPointButton(...t))},null,512),[[s.F8,r.editingPoint.account==t.account]]),(0,e.wy)((0,e._)("span",{class:"ts-icon is-check-icon iconButton",title:"確定修改",onClick:n[6]||(n[6]=(...t)=>c.confirmPointButton&&c.confirmPointButton(...t))},null,512),[[s.F8,r.editingPoint.account==t.account]]),(0,e.wy)((0,e._)("span",{class:"ts-icon is-pen-icon iconButton",title:"修改違規點數",onClick:n=>c.editPointButton(t)},null,8,C),[[s.F8,!(r.editingPoint.account==t.account)]])]),(0,e._)("td",null,(0,a.zw)(r.getStateText[t.banned]),1),(0,e._)("td",null,[0==t.banned?((0,e.wg)(),(0,e.iD)("span",{key:0,class:"ts-icon is-ban-icon iconButton-danger",title:"封鎖",onClick:n=>c.banButton(t.account)},null,8,H)):(0,e.kq)("",!0),1==t.banned?((0,e.wg)(),(0,e.iD)("span",{key:1,class:"ts-icon is-unlock-icon iconButton",title:"解除封鎖",onClick:n=>c.unbanButton(t.account)},null,8,v)):(0,e.kq)("",!0)])])),[[s.F8,c.isShow(t)]]))),128))])])])}var E=o(5591),N={props:{insertData:{default:[]}},data(){return{getRoleText:["學生","教師","管理員"],getStateText:["正常","被封鎖"],fliter:null,editingPoint:{account:null,point:null}}},created(){this.resetFliter()},methods:{resetFliter(){this.fliter={account:"",role:null,banned:null}},isShow(t){let n=!0;return t.account.includes(this.fliter.account)||(n=!1),null!=this.fliter.role&&t.role!=this.fliter.role&&(n=!1),null!=this.fliter.banned&&t.banned!=this.fliter.banned&&(n=!1),n},editPointButton(t){this.editingPoint.account=t.account,this.editingPoint.point=t.point},minusPointButton(){this.editingPoint.point>0&&this.editingPoint.point--},plusPointButton(){this.editingPoint.point<10&&this.editingPoint.point++},async confirmPointButton(){const t=window.confirm("是否要修改違規點數 ?");if(t){const t=await(0,E.iU)(this.editingPoint.account,this.editingPoint.point);switch(t){case 200:alert("修改成功 !");break;case 400:alert("修改失敗 !");break;default:alert("修改成功 !");break}window.location.reload()}this.editingPoint.account=null},async runConfirmDialog(t,n,o,e,i){const r=window.confirm(`${t} ?`);if(!r)return;const s=await o(e,i);switch(s){case 200:alert(`${n}成功 !`);break;case 400:alert(`${n}失敗 !`);break;default:alert(`${n}成功 !`);break}window.location.reload()},banButton(t){this.runConfirmDialog("是否要封鎖此人","封鎖",E.yj,t,1)},unbanButton(t){this.runConfirmDialog("是否要解除封鎖","解除封鎖",E.yj,t,0)}}},q=o(89);const J=(0,q.Z)(N,[["render",B],["__scopeId","data-v-7070bba2"]]);var U=J,$={components:{"user-info-table":U},setup(){const t=(0,r.iH)([]);return(0,e.bv)((async()=>{try{t.value=await(0,E.tX)()}catch(n){console.error("获取用户积分数据时发生错误:",n)}})),{insertData:t}}};const A=(0,q.Z)($,[["render",i]]);var F=A}}]);
//# sourceMappingURL=561.18cb5bf9.js.map